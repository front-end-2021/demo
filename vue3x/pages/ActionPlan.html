<template id="tmp-comp-vw-task">
    <div class="dnbHandle m-2 p-2 bg-008ff8 border-4px w344px d-inline-block cdefault"
        @mouseenter="e => $root.Popup_UI = null">
        <div class="wrap-info pos-relative">
            <div>{{item.Name}} ({{item.Id}}.{{item.ASort}})</div>
            <div class="wrp_menu"
                @click.stop="e => showMenuEdit(11, e)">[Edit]</div>
        </div>
        <i class="bi bi-clock me-1 font12"></i>
        <span class="font12" v-html="ViewStartEnd"></span>
        <div v-for="(todo, ii) in Todos" class="d-flex">
            <span v-if="ii < 3">{{ii + 1}}.&nbsp;</span>
            <span v-else @click.stop="showFormEdit"
                class="cpointer">[ Expand... ]</span>
            <span v-if="ii < 3"
                @input="e => onChangeTodo(ii, e)"
                style="flex-grow: 2;"
                @keypress="onPreventEnter"
                contenteditable="true">{{todo}}</span>
            <span v-if="ii < 3" class="cpointer"
                @click.stop="e => removeTodo(ii)">[ - ]</span>
        </div>
        <div v-if="Todos.length < 4" 
            class="font12" @click.stop="addTodo">[+ Todo]</div>
    </div>
</template>
<template id="tmp-comp-vw-sub">
    <div class="d-flex mb-2 minh87px">
        <div class="p-2 bg-008ff8 border-l6px">
            <div class="dnbHandle wrap-info w344px cdefault stick-top0">
                <div>{{item.Name}} ({{item.Id}}.{{item.ASort}})</div>
                <div class="wrp_menu"
                    @click.stop="e => showMenuEdit(10, e)">[Edit]</div>
                <div class="font12">
                    <i class="bi bi-clock me-1"></i>
                    <span v-html="ViewStartEnd"></span>
                </div>
            </div>
            <div v-if="AssignU == null"
                class="ui floating labeled icon dropdown button"
                @click.stop="e => showAssignUser(e)">
                <i class="add user icon"></i>Add User</div>
            <div v-else
                class="ui floating labeled icon dropdown button"
                @click.stop="e => showAssignUser(e)">
                <i class="user icon"></i>{{AssignU.Name}}</div>
        </div>
        <draggable v-model="ListTask" v-bind="DndTaskOptions" 
            handle=".dnbHandle"
            class="list-task p-2 border-r6px" >
            <transition-group>
                <comp-vw-task v-for="task in ListTask"
                    :item="task"
                    :key="task.Id">
                </comp-vw-task>
            </transition-group>
        </draggable>
    </div>
</template>
<template id="tmp-comp-vw-goal">
    <div class="p-2 bg-e8e9e9 mt-2 border-4px d-flex" >
        <div class="wrap-info"
            @mouseenter="e => $root.Popup_UI = null">
            <div class="dnbHandle w344px cdefault stick-top0" >
                <div>{{item.Name}} ({{item.Id}}.{{item.ASort}})</div>
                <div class="wrp_menu"
                    @click.stop="e => showMenuEdit(9, e)">[Edit]</div>
                <div class="font12">
                    <i class="bi bi-clock me-1"></i>
                    <span v-html="ViewStartEnd"></span>
                </div>
            </div>
        </div>
        <draggable v-model="ListSub" v-bind="DndSubOptions" 
            class="list-sub p-2 border-d6px" 
            handle=".dnbHandle">
            <transition-group>
                <comp-vw-sub v-for="sub in ListSub"
                    :item="sub"
                    :key="sub.Id"></comp-vw-sub>
            </transition-group>
        </draggable>
    </div>
</template>
<template id="tmp-comp-vw-prd">
    <div class="p-2" 
        v-observe-visibility="{
            callback: visibilityChanged,
            throttle: 0, intersection: { threshold: 0 }
        }">
        <div class="p-2 bg-006bb9 border-u6px">{{item.Name}} ({{smpdid}})</div>
        <draggable v-if="IsVisible"
            v-model="ListGoal" v-bind="DndGoalOptions" 
            style="border: 1px solid #d6d6d6;"
            class="list-goal p-2 border-d6px"
            handle=".dnbHandle">
            <transition-group>
                <comp-vw-goal v-for="goal in ListGoal" 
                    :item="goal"
                    :key="goal.Id"></comp-vw-goal>
            </transition-group>
        </draggable>
    </div>
</template>
<template id="tmp-comp-action-plan">
    <section>
        <drop-select :name="$root.UserAssign" :items="$root.Users" 
        @set:index="$event => setUserAssign($event)">
            <template #default>
                <div class="default text">{{$root.UserAssign}}</div>
            </template>
        </drop-select>
    </section>
    <h1>4ct10n Pl_n</h1>
    <section class="dnbViewAcPlan px20px" >
        <div v-for="market in ListMarket" class="bg-008ff8 border-6px mb-3"
            :key="market.Entry.Id">
            <div class="p-2 border-6px bg-008ff8">{{market.Entry.Name}}</div>
            <div v-for="subMk in market.SubMarkets" class="p-2">
                <div class="p-2 bg-008ff8">{{subMk.Entry.Name}}</div>
                <comp-vw-prd v-for="product in subMk.Products"
                    :key="product.SubmarketProductId + '_' + product.Entry.Id"
                    :item="product.Entry"
                    :smpdid="product.SubmarketProductId"></comp-vw-prd>
            </div>
        </div>
        <div v-for="prdG in ProductGroups" class="bg-008ff8 border-6px mb-3"
            :key="prdG.Entry.Id">
            <div class="p-2 border-6px bg-008ff8">{{prdG.Entry.Name}} (xy)</div>
            <div v-for="product in prdG.ListProduct" class="p-2">
                <div class="p-2 bg-008ff8">{{product.Entry.Name}}</div>
                <comp-vw-prd v-for="subMk in product.SubMarkets"
                    :key="subMk.SubmarketProductId + '_' + subMk.Entry.Id"
                    :item="subMk.Entry"
                    :smpdid="subMk.SubmarketProductId"></comp-vw-prd>
            </div>
        </div>
    </section>
    <div v-if="MenuAcPlan != null" 
        class="d-inline-block p-1 bg-006bb9 menu_golsub border-4px"
        @mouseleave="e => $root.Popup_UI = null"
        :style="[MenuAcPlan.Style]">
        <div class="p-2 cpointer menu_golsub-i mb1px border-4px"
            @click.stop="e => MenuAcPlan.editItem(MenuAcPlan.Entry, MenuAcPlan.type)">Edit item</div>
        <div v-if="9 == MenuAcPlan.type || 10 == MenuAcPlan.type"
            class="p-2 cpointer menu_golsub-i mb1px border-4px"
            @click.stop="e => MenuAcPlan.newChild(e)">New {{9 == MenuAcPlan.type ? 'Sub' : 'Task'}}</div>
        <div @click.stop="e => MenuAcPlan.copyItem(MenuAcPlan.Entry, MenuAcPlan.type)"
            class="p-2 cpointer menu_golsub-i mb1px border-4px">Copy</div>
        <div @click.stop="e => MenuAcPlan.deleteItem(MenuAcPlan.Entry, MenuAcPlan.type)"
            class="p-2 cpointer menu_golsub-i border-4px">Delete</div>
    </div>
    <div v-if="MenuAssignUser != null" 
        style="position: fixed;" :style="[MenuAssignUser.Style]"
        class="drpUserAsgn ui floating labeled icon dropdown button">
        <i class="add user icon"></i>
        <span class="text">{{MenuAssignUser.Name}}</span>
        <div class="menu">
          <div class="header">Assign user</div>
          <div v-for="(person, ii) in $root.People" class="item"
            :data-value="ii"
            style="align-items: center;display: flex;">
            <span class="d-inline-block me-1 border-4px text-center" 
                style="width: 18px;height: 18px;background-color: #565656;color: white;"
                >{{person.Name[0]}}</span>
            {{person.Name}}
          </div>
        </div>
    </div>
</template>